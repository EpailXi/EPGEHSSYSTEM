<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EPG EHS System</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f4f4f4;
    }
    header {
      background: #004d99;
      color: #fff;
      padding: 6px 10px;
      text-align: center;
    }
    .logo img {
      height: 26px;
      vertical-align: middle;
      margin-right: 8px;
    }
    .title {
      font-size: 18px;
      font-weight: bold;
      vertical-align: middle;
    }
    nav {
      display: flex;
      background: #e6e6e6;
      border-bottom: 1px solid #ccc;
      flex-wrap: wrap;
    }
    nav button {
      flex: 1;
      padding: 10px;
      border: none;
      background: inherit;
      font-size: 15px;
      cursor: pointer;
      transition: background 0.3s;
      /* ensure buttons don't submit forms */
      type: button;
    }
    nav button:hover, nav button.active {
      background: #d0e0ff;
    }
    .tab-content, .subtab-content {
      display: none;
    }
    .tab-content.active, .subtab-content.active {
      display: block;
    }
    iframe {
      width: 100%;
      height: 80vh;
      min-height: 600px;
      border: none;
    }
    .audio-buttons {
      display: flex;
      gap: 20px;
      justify-content: center;
      padding: 20px;
      flex-wrap: wrap;
    }
    .audio-buttons button {
      cursor: pointer;
      font-size: 16px;
      padding: 8px 12px;
      border: none;
      background: #004d99;
      color: #fff;
      border-radius: 4px;
      type: button;
    }
    .audio-buttons button:hover {
      background: #003366;
    }
    .audio-section {
      display: none;
      text-align: center;
      padding: 20px;
    }
    .audio-section.active {
      display: block;
    }
    .subtabs {
      display: flex;
      justify-content: center;
      background: #f0f0f0;
      border-bottom: 1px solid #ccc;
    }
    .subtabs button {
      padding: 8px 16px;
      border: none;
      background: inherit;
      cursor: pointer;
      font-size: 14px;
      type: button;
    }
    .subtabs button:hover, .subtabs button.active {
      background: #d0e0ff;
    }
    .loader {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 40px;
      font-size: 16px;
      color: #333;
    }
    .spinner {
      width: 40px;
      height: 40px;
      border: 4px solid #ccc;
      border-top: 4px solid #004d99;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 10px;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>

<header>
  <span class="logo">
    <img src="https://www.epg-module.com/logo.png" alt="EPG Module Logo">
  </span>
  <span class="title">EPG EHS System</span>
</header>

<nav role="tablist">
  <button role="tab" aria-controls="content-induction" class="active" data-tab="induction">Induction</button>
  <button role="tab" aria-controls="content-cidb" data-tab="cidb">CIDB Slip Print</button>
  <button role="tab" aria-controls="content-immigration" data-tab="immigration">Immigration Fomema Check</button>
  <button role="tab" aria-controls="content-voiceover" data-tab="voiceover">Induction Voice Over</button>
  <button role="tab" aria-controls="content-ppeInventory" data-tab="ppeInventory">PPE Inventory</button>
  <button role="tab" aria-controls="content-ppeForm" data-tab="ppeForm">PPE Issue & Return</button>
</nav>

<main>
  <div id="content-induction" class="tab-content active" data-url="https://epailxi.github.io/EPGNTPINDUCTION/"></div>
  <div id="content-cidb" class="tab-content" data-url="https://epailxi.github.io/CIDBSlipDownload/"></div>
  <div id="content-immigration" class="tab-content" data-url="https://eservices.imi.gov.my/myimms/FomemaStatus"></div>

  <div id="content-voiceover" class="tab-content">
    <div class="audio-buttons">
      <button data-lang="chinese">▶ Chinese Voice Over</button>
      <button data-lang="vietnamese">▶ Vietnamese Voice Over</button>
      <button data-lang="bangla">▶ Bangla Voice Over</button>
    </div>
    <div id="chinese" class="audio-section">
      <audio controls>
        <source src="ChinesenH.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
      </audio>
    </div>
    <div id="vietnamese" class="audio-section">
      <audio controls>
        <source src="VietnamH.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
      </audio>
    </div>
    <div id="bangla" class="audio-section">
      <audio controls>
        <source src="BanglaH.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
      </audio>
    </div>
  </div>

  <div id="content-ppeInventory" class="tab-content" data-url="https://twswzvv3ark.sg.feishu.cn/file/EJDJbsCNZoMoRIx2wujlpazVgDh"></div>
  <div id="content-ppeForm" class="tab-content">
    <div class="subtabs" role="tablist">
      <button aria-controls="subcontent-issue" class="active" data-subtab="issue">Issue & Return</button>
      <button aria-controls="subcontent-search" data-subtab="search">Search</button>
    </div>
    <div id="subcontent-issue" class="subtab-content active" data-url="https://twswzvv3ark.sg.feishu.cn/share/base/form/shrlgLgnuhFnHx9HmffMoKyrfjf"></div>
    <div id="subcontent-search" class="subtab-content" data-url="https://twswzvv3ark.sg.feishu.cn/share/base/query/shrlgX74PkvggRvBLlfoFwKzXtZ"></div>
  </div>
</main>

<script>
  const tabs = document.querySelectorAll("nav button");
  const contents = document.querySelectorAll(".tab-content");
  const subtabButtons = document.querySelectorAll(".subtabs button");
  const subcontents = document.querySelectorAll(".subtab-content");

  function getStorage(key) {
    try { return localStorage.getItem(key); } catch { return null; }
  }
  function setStorage(key, value) {
    try { localStorage.setItem(key, value); } catch {}
  }

  function activateTab(tab) {
    tabs.forEach(b => b.classList.toggle('active', b.dataset.tab === tab));
    contents.forEach(c => c.classList.toggle('active', c.id === `content-${tab}`));
    const c = document.getElementById(`content-${tab}`);
    if (c) loadIframeIfNeeded(c);
    // Reset audio when leaving voiceover
    if (tab !== 'voiceover') {
      document.querySelectorAll('.audio-section').forEach(s => s.classList.remove('active'));
    }
  }
  function activateSubtab(sub) {
    subtabButtons.forEach(b => b.classList.toggle('active', b.dataset.subtab === sub));
    subcontents.forEach(c => c.classList.toggle('active', c.id === `subcontent-${sub}`));
    const c = document.getElementById(`subcontent-${sub}`);
    if (c) loadIframeIfNeeded(c);
  }

  const saved = getStorage('activeTab');
  if (saved) activateTab(saved);
  else loadIframeIfNeeded(document.querySelector('.tab-content.active'));

  tabs.forEach(btn => btn.addEventListener('click', () => {
    setStorage('activeTab', btn.dataset.tab);
    activateTab(btn.dataset.tab);
  }));

  document.querySelectorAll('.audio-buttons button').forEach(btn => {
    btn.addEventListener('click', () => {
      const lang = btn.dataset.lang;
      document.querySelectorAll('.audio-section').forEach(s => s.classList.remove('active'));
      document.getElementById(lang).classList.add('active');
    });
  });

  subtabButtons.forEach(btn => btn.addEventListener('click', () => activateSubtab(btn.dataset.subtab)));

  function loadIframeIfNeeded(el) {
    if (el.dataset.loaded || !el.dataset.url) return;
    const loader = document.createElement('div');
    loader.className = 'loader';
    loader.innerHTML = '<div class="spinner"></div><div>Please wait ~5 seconds...</div>';
    el.appendChild(loader);
    const iframe = document.createElement('iframe');
    iframe.src = el.dataset.url;
    iframe.loading = 'lazy';
    iframe.onload = () => loader.remove();
    iframe.onerror = () => loader.innerHTML = '<div style="color:red;">Failed to load content.</div>';
    el.appendChild(iframe);
    el.dataset.loaded = 'true';
  }
</script>

</body>
</html>
